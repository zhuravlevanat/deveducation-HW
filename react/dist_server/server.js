!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=7)}([function(e,r){e.exports=require("http")},function(e,r){e.exports=require("url")},function(e,r){e.exports=require("querystring")},function(e,r){e.exports=require("mysql2/promise")},function(e,r){e.exports=require("uuidv4")},function(e,r){e.exports=require("nodemailer")},function(e,r){e.exports=require("jsdom")},function(e,r,t){t(8),e.exports=t(9)},function(e,r){e.exports=require("@babel/polyfill")},function(e,r,t){"use strict";t.r(r);var n=t(0),o=t.n(n),s=t(1),a=t.n(s),c=t(2),u=t.n(c),i=t(3),l=t.n(i),p=t(4),f=t(5),d=t.n(f),h=t(6);function v(e,r,t,n,o,s,a){try{var c=e[s](a),u=c.value}catch(e){return void t(e)}c.done?r(u):Promise.resolve(u).then(n,o)}function b(){var e;return e=regeneratorRuntime.mark(function e(r,t){var n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.a.createTransport({service:"gmail",auth:{user:"db.changing.logs@gmail.com",pass:"mailing12@"}}),e.next=3,n.sendMail({from:"db.changing.logs@gmail.com",to:t,subject:"Changes to table person",html:g(r)});case 3:o=e.sent,console.log("Message sent: %s",o.messageId);case 5:case"end":return e.stop()}},e)}),(b=function(){var r=this,t=arguments;return new Promise(function(n,o){var s=e.apply(r,t);function a(e){v(s,n,o,a,c,"next",e)}function c(e){v(s,n,o,a,c,"throw",e)}a(void 0)})}).apply(this,arguments)}function g(e){var r=new h.JSDOM("<html><head></head><body></body></html>"),t=r.window.document.createElement("table");t.style.border="1px solid black",t.innerHTML="<tr>\n                                <th>Time</th>\n                                <th>Version</th>\n                                <th>Val</th>\n                                <th>Change val</th>\n                                <th>User</th>\n                                <th>Old value</th>\n                                <th>New value</th>\n                           </tr>";for(var n=0;n<e.length;n++){var o=r.window.document.createElement("tr");o.innerHTML='\n                <td style="border-top:1px solid black;">'.concat(e[n].time,'</td>\n                <td style="border-top:1px solid black;">').concat(e[n].version,'</td>\n                <td style="border-top:1px solid black;">').concat(e[n].val,'</td>\n                <td style="border-top:1px solid black;">').concat(e[n].change_val,'</td>\n                <td style="border-top:1px solid black;">').concat(e[n].user,'</td>\n                <td style="border-top:1px solid black;">').concat(e[n].old_value,'</td>\n                <td style="border-top:1px solid black;">').concat(e[n].new_value,"</td>\n            "),t.innerHTML+=o.outerHTML}return t.outerHTML}var m=function(e,r){return b.apply(this,arguments)};function x(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function y(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?x(Object(t),!0).forEach(function(r){w(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function O(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],n=!0,o=!1,s=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){o=!0,s=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw s}}return t}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function E(e,r,t,n,o,s,a){try{var c=e[s](a),u=c.value}catch(e){return void t(e)}c.done?r(u):Promise.resolve(u).then(n,o)}function R(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var s=e.apply(r,t);function a(e){E(s,n,o,a,c,"next",e)}function c(e){E(s,n,o,a,c,"throw",e)}a(void 0)})}}function w(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}t.d(r,"default",function(){return S});var S=function e(){var r=this;!function(r,t){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this),w(this,"httpServer",null),w(this,"errorCodes",{sqlError:"SQL_ERROR",noSuchTableInDatabase:"NO_SUCH_TABLE_IN_DATABASE",noSuchCommand:"NO_SUCH_COMMAND",noSuchServerCommand:"NO_SUCH_SERVER_COMMAND",noSuchIdOfConnection:"NO_SUCH_ID_OF_CONNECTION"}),w(this,"host","localhost"),w(this,"connectionData",{}),w(this,"sqlConnections",{}),w(this,"contentTypes",{json:{"Content-Type":"application/json"}}),w(this,"httpServerPort",1010),w(this,"postProcessors",{}),w(this,"getProcessors",{}),w(this,"initialize",R(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.runHttpServer(),r.initRequestProcessors();case 2:case"end":return e.stop()}},e)}))),w(this,"connectToDb",function(){var e=R(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.createConnection(n);case 3:r.sqlConnections[t]=e.sent,r.connectionData[t]=n,console.info("Connected to DB!"),r.setConnectionErrorHandler(r.sqlConnections[t],t),e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(0),console.error("DB connection failed: ".concat(e.t0.code)),r.sqlConnections[t]=null,e.t0;case 14:case"end":return e.stop()}},e,null,[[0,9]])}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"setConnectionErrorHandler",function(e,t){e.on("error",function(){var e=R(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.dbErrorHandler(n,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(r){return e.apply(this,arguments)}}())}),w(this,"dbErrorHandler",function(){var e=R(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("PROTOCOL_CONNECTION_LOST"!==t.code){e.next=5;break}return r.sqlConnections[n].destroy(),r.sqlConnections[n]=null,e.next=5,r.connectToDb(n,r.connectionData[n]);case 5:case"end":return e.stop()}},e)}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"runHttpServer",function(){r.httpServer=o.a.createServer(function(e,t){return r.processRequest(e,t)}),r.httpServer.listen(r.httpServerPort,r.httpServerListenLog)}),w(this,"initRequestProcessors",function(){if(!r.httpServer)return console.error("Failed to init processors: HTTP server is not created."),!1;r.postProcessors={login:r.loginProcessor,logout:r.logoutProcessor,updatePerson:r.updatePersonProcessor,updateLogs:r.updateLogsProcessor,merge:r.mergeProcessor},r.getProcessors={person:r.personProcessor,personLog:r.personLogProcessor,personByID:r.personByIDProcessor}}),w(this,"httpServerListenLog",function(){console.info(new Date+"\nServer is listening on port "+r.httpServerPort)}),w(this,"processRequest",function(){var e=R(regeneratorRuntime.mark(function e(t,n){var o,s,c,i,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=a.a.parse(t.url,!0),s=o.pathname.substring(1),c=o.query,e.t0=t.method,e.next="POST"===e.t0?6:"GET"===e.t0?10:21;break;case 6:return i="",t.on("data",function(e){(i+=e).length>1e6&&t.connection.destroy()}),t.on("end",R(regeneratorRuntime.mark(function e(){var t,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("login"===s||r.isVerifyUuid(c.uuid)){e.next=2;break}return e.abrupt("return",r.sendResponse(n,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchIdOfConnection",null))));case 2:if(t=u.a.parse(i),!r.postProcessors[s]){e.next=10;break}return e.next=6,r.postProcessors[s](t,c);case 6:o=e.sent,r.sendResponse(n,r.contentTypes.json,JSON.stringify(o)),e.next=11;break;case 10:r.sendResponse(n,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchCommand",null)));case 11:case"end":return e.stop()}},e)}))),e.abrupt("break",22);case 10:if(r.isVerifyUuid(c.uuid)){e.next=12;break}return e.abrupt("return",r.sendResponse(n,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchIdOfConnection",null))));case 12:if(!r.getProcessors[s]){e.next=19;break}return e.next=15,r.getProcessors[s](c);case 15:l=e.sent,r.sendResponse(n,r.contentTypes.json,JSON.stringify(l)),e.next=20;break;case 19:r.sendResponse(n,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchCommand",null)));case 20:return e.abrupt("break",22);case 21:r.sendResponse(n,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchServerCommand",null)));case 22:case"end":return e.stop()}},e)}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"getErrorResponseObject",function(e,t){return{isError:!0,code:r.errorCodes[e],data:t||null}}),w(this,"sendResponse",function(e,r,t){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Request-Method","*"),e.setHeader("Access-Control-Allow-Methods","*"),e.setHeader("Access-Control-Allow-Headers","*"),e.writeHead(200,r),e.write(t),e.end()}),w(this,"parseData",function(e,r){var t=[];return e.forEach(function(e){t.push({id:e.id,searchValue:JSON.parse(e[r]).name})}),t}),w(this,"checkDbTable",function(){var e=R(regeneratorRuntime.mark(function e(t,n,o){var s,a,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=null,e.prev=1,e.next=4,r.sqlConnections[t].execute("SHOW TABLES FROM ".concat(n," LIKE '").concat(o,"'"));case 4:a=e.sent,c=O(a,1),u=O(c[0],1),s=u[0],e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(1),e.t0;case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}},e,null,[[1,10]])}));return function(r,t,n){return e.apply(this,arguments)}}()),w(this,"createBDTable",function(){var e=R(regeneratorRuntime.mark(function e(t,n,o){var s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=null,e.prev=1,e.next=4,r.sqlConnections[t].execute("CREATE TABLE IF NOT EXISTS ".concat(n," ").concat(o));case 4:a=e.sent,s=a,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 11:return e.abrupt("return",{isError:!1,data:[y({},s[0])]});case 12:case"end":return e.stop()}},e,null,[[1,8]])}));return function(r,t,n){return e.apply(this,arguments)}}()),w(this,"getUserGrants",function(){var e=R(regeneratorRuntime.mark(function e(t,n){var o,s,a,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=null,e.prev=1,e.next=4,r.sqlConnections[t].execute("SHOW GRANTS FOR '".concat(n,"'@'").concat(r.host,"'"));case 4:s=e.sent,a=O(s,1),c=O(a[0],1),o=c[0],e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 13:return e.abrupt("return",Object.values(o)[0]);case 14:case"end":return e.stop()}},e,null,[[1,10]])}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"isVerifyUuid",function(e){return r.sqlConnections.hasOwnProperty(e)}),w(this,"readLastId",function(){var e=R(regeneratorRuntime.mark(function e(t,n){var o,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.sqlConnections[t].execute("SELECT MAX(id) FROM ".concat(n));case 3:return o=e.sent,s=O(o,1),a=s[0],e.abrupt("return",JSON.stringify(a[0]["MAX(id)"]));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 12:case"end":return e.stop()}},e,null,[[0,9]])}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"loginProcessor",function(){var e=R(regeneratorRuntime.mark(function e(t){var n,o,s,a,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,o=Object(p.uuid)(),s=t.user,a=t.password,c=t.database,u=t.table,e.prev=3,e.next=6,r.connectToDb(o,{host:r.host,user:s,password:a,database:c});case 6:return e.next=8,r.checkDbTable(o,c,u);case 8:if(e.sent){e.next=11;break}return e.abrupt("return",r.getErrorResponseObject("noSuchTableInDatabase",r.errorCodes.noSuchTableInDatabase));case 11:return e.next=13,r.getUserGrants(o,s);case 13:n=e.sent,e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(3),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,"}")));case 19:return e.abrupt("return",{isError:!1,uuid:o,data:{state:"Connected!",grants:n}});case 20:case"end":return e.stop()}},e,null,[[3,16]])}));return function(r){return e.apply(this,arguments)}}()),w(this,"logoutProcessor",function(){var e=R(regeneratorRuntime.mark(function e(t,n){var o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.uuid,s=null,e.prev=2,e.next=5,r.sqlConnections[o].end();case 5:delete r.sqlConnections[o],s="Connection end",console.info("Connection ".concat(o," end")),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 13:return e.abrupt("return",{isError:!1,data:s});case 14:case"end":return e.stop()}},e,null,[[2,10]])}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"personProcessor",function(){var e=R(regeneratorRuntime.mark(function e(t){var n,o,s,a,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uuid,o=t.version,s=null,e.prev=2,e.next=5,r.sqlConnections[n].execute("SELECT id, ".concat(o," FROM person"));case 5:a=e.sent,c=O(a,1),u=c[0],s=r.parseData(u,o),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:return e.abrupt("return",{isError:!1,data:s});case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(r){return e.apply(this,arguments)}}()),w(this,"personLogProcessor",function(){var e=R(regeneratorRuntime.mark(function e(t){var n,o,s,a,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uuid,o=t.version,s=null,e.prev=2,e.next=5,r.sqlConnections[n].execute("SELECT * FROM person_logs WHERE version='".concat(o,"'"));case 5:a=e.sent,c=O(a,1),u=c[0],s=u,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:return e.abrupt("return",{isError:!1,data:s});case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(r){return e.apply(this,arguments)}}()),w(this,"personByIDProcessor",function(){var e=R(regeneratorRuntime.mark(function e(t){var n,o,s,a,c,u,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uuid,o=t.version,s=t.id,a=null,e.prev=2,e.next=5,r.sqlConnections[n].execute("SELECT id, ".concat(o," FROM person WHERE id=").concat(s));case 5:c=e.sent,u=O(c,1),i=u[0],a=JSON.parse(i[0][o]),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:return e.abrupt("return",{isError:!1,data:a});case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(r){return e.apply(this,arguments)}}()),w(this,"updatePersonProcessor",function(){var e=R(regeneratorRuntime.mark(function e(t,n){var o,s,a,c,u,i,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.uuid,s=n.version,a=n.id,c=null,e.prev=2,e.next=5,r.sqlConnections[o].execute("UPDATE person SET ".concat(s,"='").concat(JSON.stringify(t),"' WHERE id='").concat(a,"'"));case 5:u=e.sent,i=O(u,1),l=i[0],c=l,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:return e.abrupt("return",{isError:!1,data:c});case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"updateLogsProcessor",function(){var e=R(regeneratorRuntime.mark(function e(t,n){var o,s,a,c,u,i,l,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.uuid,s=n.version,a=null,e.prev=2,e.next=5,r.createBDTable(o,"person_logs","(\n                id int(50) NOT NULL AUTO_INCREMENT,\n                time timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n                version text,\n                ".concat("val"," varchar(50),\n                change_val varchar(50),\n                user varchar(50),\n                old_value varchar(100),\n                new_value varchar(100),\n                PRIMARY KEY (id)\n            )"));case 5:return e.next=7,r.createBDTable(o,"persons_update_emails","(\n                id int(11) NOT NULL AUTO_INCREMENT,\n                email varchar(50),\n                PRIMARY KEY (id)\n            )");case 7:c=0,u=[],i=0,l=Object.values(t);case 10:if(!(i<l.length)){e.next=24;break}return p=l[i],e.next=14,r.sqlConnections[o].execute("INSERT INTO person_logs (version, ".concat("val",", change_val, user, old_value, new_value)\n                    VALUES(\n                        '").concat(s,"',\n                        '").concat("name","',\n                        '").concat(p[0],"',\n                        '").concat(p[1],"',\n                        '").concat(p[2],"',\n                        '").concat(p[3],"'\n                    )"));case 14:if(!e.sent){e.next=21;break}return c++,e.next=19,r.readLastId(o,"person_logs");case 19:f=e.sent,u=[].concat(function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(d=u)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(d)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}(),[f]);case 21:i++,e.next=10;break;case 24:if(!(u.length>0)){e.next=27;break}return e.next=27,r.mailing(o,u);case 27:a={affectedRows:c},e.next=33;break;case 30:return e.prev=30,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 33:return e.abrupt("return",{isError:!1,data:a});case 34:case"end":return e.stop()}var d},e,null,[[2,30]])}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"mergeProcessor",function(){var e=R(regeneratorRuntime.mark(function e(t,n){var o,s,a,c,u,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.uuid,s=n.id,a=null,e.prev=2,e.next=5,r.sqlConnections[o].execute("UPDATE person SET \n                    variant1='".concat(JSON.stringify(t),"', \n                    variant2='").concat(JSON.stringify(t),"', \n                    variant3='").concat(JSON.stringify(t),"', \n                    variant4='").concat(JSON.stringify(t),"'\n                WHERE id='").concat(s,"'"));case 5:c=e.sent,u=O(c,1),i=u[0],a=i,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:return e.abrupt("return",{isError:!1,data:a});case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(r,t){return e.apply(this,arguments)}}()),w(this,"mailing",function(){var e=R(regeneratorRuntime.mark(function e(t,n){var o,s,a,c,u,i,l,p,f,d,h,v,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="",e.next=3,r.sqlConnections[t].execute("SELECT email FROM persons_update_emails");case 3:for(s=e.sent,a=O(s,1),c=a[0],u=!0,i=!1,l=void 0,e.prev=9,p=c[Symbol.iterator]();!(u=(f=p.next()).done);u=!0)d=f.value,o+="".concat(d.email,", ");e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),i=!0,l=e.t0;case 17:e.prev=17,e.prev=18,u||null==p.return||p.return();case 20:if(e.prev=20,!i){e.next=23;break}throw l;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return o=o.substring(0,o.length-2),e.next=28,r.sqlConnections[t].execute("SELECT * FROM person_logs WHERE id IN (".concat(n.join(","),")"));case 28:return h=e.sent,v=O(h,1),b=v[0],e.next=33,m(b,o).catch(console.error);case 33:case"end":return e.stop()}},e,null,[[9,13,17,25],[18,,20,24]])}));return function(r,t){return e.apply(this,arguments)}}())};console.info("Production status: ".concat(!0,".")),R(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new S,e.next=3,r.initialize();case 3:case"end":return e.stop()}},e)}))()}]);